# 高度検索・フィルタリング機能 - 使用ガイド

## 🎯 機能概要

高度検索・フィルタリング機能は、膨大な投稿データから特定の条件に一致する投稿を効率的に検索できる包括的な検索システムです。キーワード検索から複雑な条件組み合わせまで対応しています。

## 🚀 アクセス方法

**URL**: http://localhost:3000 → ダッシュボード → 「全投稿一覧」タブ

## 🔍 検索機能一覧

### 1. 基本検索

#### キーワード検索
- **対象**: 投稿内容のテキスト
- **方式**: 部分一致検索
- **例**: 「面白い」で検索 → 「この漫画面白いですね」がヒット

#### ステータスフィルター
- **approved**: 承認済み投稿
- **pending**: レビュー待ち投稿  
- **rejected**: 拒否済み投稿
- **all**: 全ステータス

#### ソート機能
- **作成日時**: 新しい順/古い順
- **AIスコア**: 高い順/低い順
- **ユーザーID**: 昇順

### 2. 詳細フィルター

詳細フィルタースイッチをONにすると追加の検索条件が利用可能。

#### ユーザーIDフィルター
```
入力例: "test_user"
結果: test_user, test_user_001, quick_test_user など
```

#### 漫画タイトルフィルター
```
入力例: "ワンピース"
結果: ワンピース、ワンピース外伝 など
```

#### リスクタイプフィルター
- **harassment**: 誹謗中傷
- **spoiler**: ネタバレ
- **inappropriate_content**: 不適切コンテンツ
- **brand_damage**: ブランド毀損
- **spam**: スパム
- **personal_info**: 個人情報
- **editorial_feedback**: 編集・校正指摘

#### AIスコア範囲指定
- **スライダー**: 0% - 100%の範囲指定
- **用途**: 特定リスクレベルの投稿抽出
- **例**: 50%-80%で中程度リスクのみ表示

#### 日付範囲指定
- **開始日**: YYYY-MM-DD形式
- **終了日**: YYYY-MM-DD形式
- **用途**: 特定期間の投稿分析

## 📱 UI構成

```
┌─────────────────────────────────────────────────────────┐
│ 🔍 検索・フィルター                    [詳細フィルター] [クリア] │
├─────────────────────────────────────────────────────────┤
│ 投稿内容で検索 [____________] [ステータス▼] [並び順▼]      │
│                                                         │
│ ═══ 詳細フィルター（展開時）═══                          │
│ ユーザーID [_______] 漫画タイトル [_______] リスク [▼]    │
│ AIスコア範囲: 20% - 80% [━━●━━━━━━━━●━━━━━━━━━━━━━━━]   │
│ 開始日 [2024-01-01] 終了日 [2024-12-31]                │
└─────────────────────────────────────────────────────────┘
```

## 🔧 使用方法

### 基本的な検索手順

1. **キーワード入力**
   - 投稿内容検索欄にキーワードを入力
   - リアルタイムで検索結果が更新

2. **ステータス選択**
   - ドロップダウンから対象ステータスを選択
   - 「全て」「承認済み」「レビュー待ち」「拒否済み」

3. **並び順指定**
   - 作成日時（新しい順/古い順）
   - AIスコア（高い順/低い順）
   - ユーザーID（昇順）

### 詳細検索手順

1. **詳細フィルター有効化**
   - 「詳細フィルター」スイッチをON

2. **条件指定**
   - 各フィルター項目に条件を入力
   - 複数条件は AND 条件で組み合わせ

3. **実行**
   - 条件入力と同時に自動実行
   - 結果は即座に表示更新

## 📊 検索例とAPI呼び出し

### 例1: キーワード検索
```
条件: 「面白い」を含む投稿
API: GET /api/posts?search=面白い&limit=10
結果: 投稿内容に「面白い」を含む投稿一覧
```

### 例2: リスクタイプフィルター
```
条件: 誹謗中傷リスクが検出された投稿
API: GET /api/posts?risk_type=harassment&limit=10
結果: harassment リスクが検出された投稿一覧
```

### 例3: 複合条件検索
```
条件: 
- ユーザー: "test" を含む
- AIスコア: 0.5-0.8
- 期間: 2024-06-01 以降
API: GET /api/posts?user_id=test&ai_score_min=0.5&ai_score_max=0.8&date_from=2024-06-01
```

### 例4: 特定ユーザーの高リスク投稿
```
条件:
- ユーザー: "problem_user"
- AIスコア: 70%以上
- ステータス: レビュー待ち
API: GET /api/posts?user_id=problem_user&ai_score_min=0.7&status=pending
```

## 📋 検索結果の表示

### テーブル表示
- **展開可能な行**: 各投稿の詳細情報を表示
- **ステータスアイコン**: 視覚的なステータス識別
- **AIスコア表示**: カラーコード付きスコア
- **作成日時**: 相対時間表示

### 詳細情報（展開時）
- **投稿内容**: 全文表示
- **AI分析結果**: 各リスクカテゴリのスコア
- **検出されたリスク**: チップ表示
- **AI判定理由**: 自然言語での説明
- **検出された問題**: 具体的な問題点リスト

### ページネーション
- **件数選択**: 5件/10件/25件/50件
- **正確な総件数**: フィルター適用後の正確な件数
- **ページ移動**: 前後ページ、直接ページ指定

## 💡 効果的な活用方法

### 1. 問題ユーザーの調査
```
手順:
1. ユーザーIDフィルターに対象ユーザーを入力
2. AIスコア範囲を50%以上に設定
3. 並び順をAIスコア高い順に変更
4. 問題投稿パターンを分析
```

### 2. 特定作品の炎上監視
```
手順:
1. 漫画タイトルフィルターに作品名を入力
2. リスクタイプを「誹謗中傷」「ブランド毀損」に絞り込み
3. 作成日時を新しい順でソート
4. 最新の問題投稿を確認
```

### 3. 定期的なリスク分析
```
手順:
1. 日付範囲を過去1週間に設定
2. AIスコア範囲を30%以上に設定
3. ステータスを「レビュー待ち」に絞り込み
4. 対応が必要な投稿を特定
```

### 4. スパム検知パターン分析
```
手順:
1. リスクタイプを「スパム」に設定
2. 作成日時でソート
3. 同一ユーザーの重複投稿パターンを確認
4. スパム投稿の傾向を分析
```

## ⚡ パフォーマンス最適化

### 検索の高速化
- **インデックス**: 主要検索項目にDB索引を設定
- **部分一致**: LIKE演算子の効率的な使用
- **ページネーション**: LIMIT/OFFSETによる分割読み込み

### UI応答性
- **リアルタイム検索**: debounce処理で無駄なAPI呼び出しを削減
- **ローディング表示**: 検索中の視覚的フィードバック
- **エラーハンドリング**: 検索失敗時の適切なメッセージ表示

## 🔧 検索条件のクリア

### 全条件クリア
- **クリアボタン**: 全ての検索条件を初期状態にリセット
- **対象項目**:
  - キーワード検索
  - ステータスフィルター
  - ユーザーID・漫画タイトル
  - リスクタイプ
  - AIスコア範囲
  - 日付範囲
  - ソート設定

### 個別条件クリア
- **入力欄のクリア**: 各入力欄を個別にクリア可能
- **ドロップダウンリセット**: 「全て」選択状態に戻す

## 📈 検索ログと分析

### 検索パフォーマンス
```javascript
// 検索実行ログの例
{
  query: "search=面白い&status=approved",
  results: 15,
  executionTime: "245ms",
  timestamp: "2024-06-16T03:30:45Z"
}
```

### よく使われる検索パターン
1. **高リスク投稿**: `ai_score_min=0.7`
2. **特定ユーザー**: `user_id=problem_user`
3. **最新の問題**: `status=pending&sort_order=DESC`
4. **スパム調査**: `risk_type=spam`

## ⚠️ 注意事項

### 検索制限
- **文字数制限**: キーワードは100文字まで
- **結果上限**: 1回の検索で最大1000件まで
- **タイムアウト**: 30秒でタイムアウト

### データ更新
- **リアルタイム反映**: 新規投稿は即座に検索対象に追加
- **キャッシュ**: 頻繁な検索結果は一時キャッシュ
- **整合性**: トランザクション処理による データ整合性保証

### セキュリティ
- **SQLインジェクション対策**: パラメータ化クエリ使用
- **入力値検証**: 不正な検索条件の排除
- **アクセス制御**: 管理者権限での使用限定

## 🚀 今後の機能拡張

### 高度な検索機能
- [ ] **正規表現検索**: 複雑なパターンマッチング
- [ ] **全文検索**: ElasticSearchによる高速全文検索
- [ ] **ファジー検索**: 曖昧検索・typo許容

### 検索条件の保存
- [ ] **検索条件保存**: よく使う条件のブックマーク
- [ ] **検索履歴**: 過去の検索条件の再利用
- [ ] **定期検索**: スケジュール実行とアラート

### エクスポート機能
- [ ] **検索結果エクスポート**: CSV/Excel形式での出力
- [ ] **レポート生成**: 検索結果の自動レポート
- [ ] **API提供**: 外部システムからの検索API利用

この高度検索・フィルタリング機能により、大量の投稿データから目的の情報を素早く特定し、効率的なモデレーション作業が実現できます。